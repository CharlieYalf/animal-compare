<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Cat or Puppy?</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<h1>Cat or Puppy?</h1>
	<div class="container">
		<div class="input-column">
			<h2>Input Photo:</h2>
			<p>Predict whether an image is of a cat or dog by uploading an image below:</p>
			<input id="photo" type="file">
			<br>
			<button id="submit">Submit</button>
		</div>
		<div class="output-column">
			<div id="results"></div>
		</div>
	</div>
	<script>
		async function loaded(reader) {
			const image = new Image();
			image.src = reader.result;

			const canvas = document.createElement('canvas');
			const ctx = canvas.getContext('2d');
			canvas.width = image.width;
			canvas.height = image.height;
			ctx.drawImage(image, 0, 0);

			// Resize the image to a smaller size
			const MAX_WIDTH = 128;
			const MAX_HEIGHT = 128;
			let width = image.width;
			let height = image.height;

			if (width > height) {
				if (width > MAX_WIDTH) {
					height *= MAX_WIDTH / width;
					width = MAX_WIDTH;
				}
			} else {
				if (height > MAX_HEIGHT) {
					width *= MAX_HEIGHT / height;
					height = MAX_HEIGHT;
				}
			}

			canvas.width = width;
			canvas.height = height;

			const resizeCtx = canvas.getContext('2d');
			resizeCtx.drawImage(image, 0, 0, width, height);

			const dataURL = canvas.toDataURL('image/jpeg', 0.9);

			const response = await fetch('https://hf.space/embed/JawdinMorris/catdog/+/api/predict/', {
				method: "POST", body: JSON.stringify({"data": [dataURL]}),
				headers: {"Content-Type": "application/json"}
			});
			const json = await response.json();
			const label = json['data'][0]['confidences'][0]['label'];
			results.innerHTML = `<h2> We think this photo is of a...</h2> <p class="prediction">${label}</p><img src="${dataURL}" width="128">`
		}

		function read() {
			if (photo.files && photo.files[0]) {
				const reader = new FileReader();

				reader.addEventListener('load', () => loaded(reader))
				reader.readAsDataURL(photo.files[0]);
			} else {
				// Handle the case where the file was not uploaded correctly
				console.error('No file uploaded');
			}
		}
		function submitForm() {
			const results = document.getElementById('results');
			results.innerHTML = `<h2>We're thinking...</h2>`;
			read();
		}
		photo.addEventListener('input', read);
		submit.addEventListener('click', submitForm);
	</script>
</body>

</html>